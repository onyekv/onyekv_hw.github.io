---
title: "Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source: embed
  
---

```{r setup, include=FALSE}
library(flexdashboard)
library(knitr)
library(rmarkdown)
library(p8105.datasets)
library(tidyverse)
library(plotly)
data("instacart")

```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A
##### This grouped bar intends to show on average, the hour that each product is ordered each day of the week. Products were limited to "Natural Spring Water", "Spring Water", "Bulgarian Yogurt", "Strawberries", "Sauvignon Blanc", "Pinot Noir".
```{r}

instacart %>%
  filter(product_name %in% c("Natural Spring Water", "Spring Water", "Bulgarian Yogurt", "Strawberries", "Sauvignon Blanc", "Pinot Noir")) %>%
  mutate(
    order_dow = recode_factor(order_dow,
        "0" = "Sunday", "1" = "Monday", "2" = "Tuesday", "3" = "Wednesday", "4"= "Thursday", "5" = "Friday", "6" = "Saturday")) %>%   group_by(department, order_dow)  %>%
  summarize(
    mean_hour = mean(order_hour_of_day)) %>% 
  
  plot_ly( x = ~mean_hour, y =~ order_dow, color = ~department, type = "bar", orientation = 'h') %>% 
  layout(yaxis = list(title = 'Order Day of Week'), xaxis = list(title = 'Mean Hour of the Day'),  colors = "viridis", barmode = 'group', autosize = F, width = 700, height = 350)
 
```
Column {data-width=650}
-----------------------------------------------------------------------

### Chart B
##### Top 3 departments 

```{r}
try2 = instacart %>% filter(department == c("produce", "dairy eggs", "snacks"))%>%
  group_by(product_id, product_name, department_id, department)%>%
summarise(count = sum(product_id)) 

try2 %>%  group_by(department) %>% 
 slice(1:3)  %>%
  mutate (department= factor(department, levels = c("snacks", "dairy eggs", "produce"))) %>%
    arrange(desc(count)) %>% 



  
    plot_ly( x = ~count, y =~ department, type = "bar", orientation = 'h') %>% 
  layout(yaxis = list(title = 'Product Name', categoryarray = ~department, categoryorder = "array"), xaxis = list(title = 'Order Frequency'),colors = "viridis", barmode = 'group', autosize = F, width = 700, height = 350) 
```

### Chart C
##### Top 3 departments with the most products
```{r}
try = instacart %>% filter(department == c("produce", "dairy eggs", "snacks"))%>%
  group_by(product_id, product_name, department_id, department)%>%
summarise(count = sum(product_id)) 

data_new2 <- try %>% mutate (department= factor(department, levels = c("snacks", "dairy eggs", "produce"))) %>% 
  arrange(desc(count)) %>% 
  group_by(department) %>%
  slice(1:3)






data_new2 %>% arrange(desc(count, department)) %>% 
  
    plot_ly( x = ~count, y =~ product_name, color = ~department, type = "bar", orientation = 'h')%>% 
  layout(yaxis = list(title = 'Product Name', categoryarray = ~product_name, categoryorder = "array"), xaxis = list(title = 'Order Frequency'),colors = "viridis", barmode = 'group', autosize = F, width = 700, height = 350) 
```

### Chart D

```{r}
instacart %>% filter(department == c("produce", "dairy eggs", "snacks", "beverages", "frozen")) %>% 
    group_by(department, order_dow)  %>%
  mutate(department = factor(department),
    order_dow =  recode_factor(order_dow,
        "0" = "Sunday", "1" = "Monday", "2" = "Tuesday", "3" = "Wednesday", "4"= "Thursday", "5" = "Friday", "6" = "Saturday")) %>% 
  summarize(
    mean_hour = mean(order_hour_of_day)) %>% 
  
  
  plot_ly( x = ~mean_hour, y =~ order_dow, color = ~department, type = "bar", orientation = 'h') %>% 
  layout(yaxis = list(title = 'Order Day of Week'), xaxis = list(title = 'Mean Hour of the Day'),  colors = "viridis", barmode = 'group', autosize = F, width = 700, height = 350)
 
```


Column {data-width=650}
-----------------------------------------------------------------------

### Chart E 

##### This figure is intended to show the rate at which items are re-ordered,for the fruit, vegetables, and packaged fruit vegetables aisle.
```{r, echo= FALSE, eval=FALSE}
##finding the total amount of items reordered##
instacart %>% 
  select(product_id, product_name, aisle, aisle_id, reordered
         ) %>% filter(reordered == 1) %>% 
  mutate( total_reordered = sum(reordered))

##finding the total amount of ALL items reordered for the 3 aisles##
instacart %>% 
  select(product_id, product_name, aisle, aisle_id, reordered, everything()
         ) %>% filter(reordered == 1) %>%   group_by(aisle) %>% 
  mutate( total_reordered_in_aisle = sum(reordered))%>%  filter(aisle == c("fresh vegetables", "fresh fruits", "packaged vegetables fruits")) 

#creating the rate, the number of items order for specific aisle by the 
instacart %>% 
  select(product_id, product_name, aisle, aisle_id, reordered
         ) %>% filter(reordered == 1) %>%   group_by(aisle) %>% 
  mutate( total_reordered_in_aisle = sum(reordered),
          aisle = factor(aisle),
          fresh_veg_reorder_rate = 91368/828824,
          packaged_reorder_rate = 51523	/828824,
          fresh_fruit_reorder = 110782 / 828824)

```

### Chart F

```{r}
aisle<- factor(c("Fruits", "Vegetables", "Packaged Fruits Vegetables")) 
y<-  as.numeric(c(0.1336617*100, 0.1102381*100,	0.06216398*100))

new_df1 <-data.frame(aisle,y)
new_df1  %>% 

 plot_ly(
   x = ~aisle,
   y =~ y, type = "scatter", mode = "lines+markers") %>%  layout(yaxis = list(title = '% Products Re-ordered'), xaxis = list(title = 'Aisle'),  colors = "viridis", autosize = F, width = 500, height = 400)
 
```

### Chart G
This figure intends to display the distribution of products in each aisle that were or were not reordered
```{r}
instacart %>% group_by(aisle, reordered, product_id) %>%   filter(aisle %in% c("fresh vegetables", "packaged vegetables fruits"))%>%
   count(product_name)  %>%  mutate(reordered = factor(reordered)) %>% 
plot_ly(
   x = ~aisle,
   y =~ n, 
   color = ~reordered, split = ~reordered, type = "violin", violinmode = "group") %>% 
  layout(title ="Distribution of Reordered or Not Reordered products, by Aisle", yaxis = list(title = 'Number of Products'), xaxis = list(title = 'Aisle'),  colors = "viridis")
```


